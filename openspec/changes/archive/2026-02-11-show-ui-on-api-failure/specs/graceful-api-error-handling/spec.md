## ADDED Requirements

### Requirement: 認証エラー時の UI 表示
認証エラーが発生した場合でも、アプリケーションはログインフォームを表示し、ユーザーが再ログインできる状態を維持しなければならない（MUST）。エラー時に操作不能な画面を表示してはならない。

#### Scenario: 認証失敗時にログインフォームを表示
- **WHEN** VRChat API 認証チェック (`command_check_auth`) が失敗した場合
- **THEN** アプリケーションはエラーメッセージのみの画面ではなく、`<LoginForm>` コンポーネントを表示しなければならない

#### Scenario: 認証エラー時に早期リターンしない
- **WHEN** `App.tsx` の `useQuery` で `isError` が true になった場合
- **THEN** アプリケーションは早期リターンせず、`<LoginForm>` を表示して再ログインを可能にしなければならない

### Requirement: アバター一覧エラー時の UI 表示
アバター一覧取得エラーが発生した場合でも、アプリケーションは通常の UI コンポーネント（ヘッダー、フッター、操作パネル）を表示し、ユーザーが操作を継続できる状態を維持しなければならない（MUST）。

#### Scenario: アバター取得失敗時に UI を表示
- **WHEN** VRChat API アバター一覧取得 (`command_fetch_avatars`) が失敗した場合
- **THEN** アプリケーションはエラーメッセージのみの画面ではなく、`<MainAppShell>` コンポーネントを表示し、空のアバター一覧として扱わなければならない

#### Scenario: アバター一覧エラー時に早期リターンしない
- **WHEN** `MainAppShell.tsx` の `avatarListQuery` で `isError` が true になった場合
- **THEN** アプリケーションは早期リターンせず、空データで UI を表示しなければならない

#### Scenario: 空のアバター一覧でフォールバック UI を表示
- **WHEN** アバター一覧が空配列として返された場合
- **THEN** `<AvatarList>` コンポーネントは「アバターが見つかりません」などのフォールバック UI を表示しなければならない

### Requirement: エラー通知
API 呼び出しエラーが発生した場合、アプリケーションは Mantine の `notifications.show()` を使用してユーザーにエラー内容を明示的に通知しなければならない（MUST）。

#### Scenario: 認証エラー時の通知表示
- **WHEN** VRChat API 認証チェックが失敗した場合
- **THEN** アプリケーションは「認証に失敗しました」などのエラー通知を `notifications.show()` で表示し、`color: 'red'` を使用して視覚的に強調しなければならない

#### Scenario: アバター一覧取得エラー時の通知表示
- **WHEN** VRChat API アバター一覧取得が失敗した場合
- **THEN** アプリケーションは「アバターの読み込みに失敗しました」などのエラー通知を `notifications.show()` で表示し、エラーメッセージを含めなければならない

#### Scenario: 通知の非ブロッキング性
- **WHEN** エラー通知が表示された場合
- **THEN** 通知はトースト形式で表示され、ユーザーの操作をブロックしてはならない

### Requirement: キャッシュデータでの動作
API 呼び出しが失敗した場合、アプリケーションは前回取得したキャッシュデータを保持し、UI コンポーネントが正常にレンダリングできる状態を維持しなければならない（MUST）。最新の状態ではないかもしれないが、ユーザーが部分的にでもアプリを利用し続けられることが重要である。

#### Scenario: アバター一覧取得失敗時にキャッシュデータを保持
- **WHEN** `useAvatarListQuery` で API 呼び出しが失敗し、前回のキャッシュデータが存在する場合
- **THEN** クエリ関数は `throw` せず、TanStack Query が前回のキャッシュデータを保持しなければならない

#### Scenario: キャッシュデータで UI コンポーネントがレンダリング可能
- **WHEN** エラー時にキャッシュデータがアバター一覧として渡された場合
- **THEN** `<MainAppShell>` および `<AvatarList>` は前回のデータを表示し、正常にレンダリングされなければならない

#### Scenario: 初回エラー時のフォールバック
- **WHEN** API 呼び出しが失敗し、キャッシュデータが存在しない場合（初回エラー）
- **THEN** アプリケーションは空データとして扱い、フォールバック UI を表示しなければならない

#### Scenario: UI でキャッシュ利用を明示
- **WHEN** エラー時にキャッシュデータを表示する場合
- **THEN** アプリケーションはメイン UI に Alert バナーを表示し、「前回のデータを表示しています」などのメッセージでキャッシュ利用を明示しなければならない。エラー通知はエラー発生のみを伝え、リトライのたびに表示されることを考慮して簡潔にすべきである

### Requirement: リトライ機能
エラー発生後、ユーザーは再ログインボタンやリフレッシュボタンを使用して API 呼び出しを再試行できなければならない（MUST）。

#### Scenario: 認証エラー後の再ログイン
- **WHEN** 認証エラーが発生し、`<LoginForm>` が表示された場合
- **THEN** ユーザーはログインフォームから再度認証を試行でき、成功時に `queryClient.invalidateQueries(['auth_check'])` で状態をリセットしなければならない

#### Scenario: アバター一覧エラー後のリフレッシュ
- **WHEN** アバター一覧取得エラーが発生した場合
- **THEN** ユーザーはヘッダーのリフレッシュボタンを使用してアバター一覧の再取得を試行できなければならない

#### Scenario: TanStack Query のキャッシュ無効化
- **WHEN** ユーザーがリトライ操作を実行した場合
- **THEN** アプリケーションは `queryClient.invalidateQueries()` を使用して該当するクエリキャッシュを無効化し、最新データを取得しなければならない
